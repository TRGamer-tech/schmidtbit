<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Tech Fact</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Courier New', Courier, monospace; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
        /* Custom scrollbar for the terminal feel */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-900 text-green-400 flex items-center justify-center min-h-screen p-4">

    <div class="max-w-2xl w-full bg-gray-800 border-2 border-green-500 p-8 rounded-lg shadow-[0_0_20px_rgba(34,197,94,0.3)] flex flex-col gap-6">
        
        <!-- Header -->
        <div class="flex justify-between items-end border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-3xl font-bold uppercase tracking-widest text-green-500 shadow-green-500/50">
                    System.Fact()
                </h1>
                <p id="date-display" class="text-gray-400 text-sm mt-1">Initializing...</p>
            </div>
            <div class="text-xs text-gray-500 text-right">
                STATUS: <span class="text-green-500 animate-pulse">ONLINE</span><br>
                AI_MODULE: <span id="ai-status" class="text-gray-600">STANDBY</span>
            </div>
        </div>

        <!-- Main Fact Area -->
        <div class="min-h-[120px] flex flex-col justify-center bg-gray-900/50 p-6 rounded border border-green-500/30">
            <p id="fact-text" class="text-xl leading-relaxed">
                Scanning global archives...
            </p>
            <p id="year-display" class="text-right text-gray-500 font-bold text-2xl mt-4 opacity-0 transition-opacity duration-500">
                <!-- Year goes here -->
            </p>
        </div>

        <!-- AI Analysis Area (Hidden by default) -->
        <div id="ai-panel" class="hidden bg-gray-900 border-l-4 border-purple-500 p-4 shadow-lg transition-all duration-300">
            <h3 class="text-purple-400 text-xs font-bold uppercase mb-2 flex items-center gap-2">
                <span>✨ GEMINI ANALYSIS PROTOCOL</span>
                <span id="ai-spinner" class="hidden animate-spin">⟳</span>
            </h3>
            <p id="ai-content" class="text-gray-300 text-sm leading-relaxed font-mono">
                <!-- AI content goes here -->
            </p>
        </div>

        <!-- Footer / Controls -->
        <div class="pt-4 border-t border-gray-700 flex flex-wrap justify-between items-center gap-4">
            <a id="source-link" href="#" target="_blank" class="text-xs text-gray-500 hover:text-green-400 transition-colors hidden">
                [ READ SOURCE ]
            </a>
            
            <div class="flex gap-3 ml-auto">
                <button onclick="decodeData()" class="px-4 py-2 bg-purple-900/30 hover:bg-purple-900/50 text-purple-300 rounded text-sm border border-purple-500/50 transition-all hover:shadow-[0_0_15px_rgba(168,85,247,0.3)] flex items-center gap-2">
                    ✨ DECODE DATA
                </button>
            </div>
        </div>

    </div>

    <script>
        const apiKey = ""; // System will inject key at runtime

        // Refined Tech keywords - Keeping strict filters
        const TECH_KEYWORDS = [
            "computer", "internet", "world wide web", "software", "hardware", "microchip", 
            "microprocessor", "cpu", "gpu", "ram", "algorithm", "cyber", "digital", 
            "server", "network", "interface", "pixel", "artificial intelligence", 
            "neural network", "machine learning", "apple inc", "macintosh", "microsoft", 
            "ibm", "google", "amazon.com", "facebook", "linux", "unix", "ubuntu", 
            "transistor", "silicon valley", "semiconductor", "telecom", "wireless", 
            "bluetooth", "wi-fi", "wifi", "ethernet", "email", "e-mail", "smartphone", 
            "iphone", "android", "browser", "operating system", "database", 
            "programming language", "source code", "open source", "videogame", "video game", 
            "nintendo", "sega", "atari", "playstation", "xbox", "cloud computing", "virtual reality",
            "supercomputer", "mainframe", "firewall", "encryption", "cryptography"
        ];

        // Exclude Space stuff explicitly
        const EXCLUDED_KEYWORDS = [
            "river", "forest", "jungle", // Amazon
            "fruit", "beatles", "corps", // Apple
            "biological", "disease", "outbreak", "pandemic", // Virus/Bug
            "legal code", "da vinci", // Code
            "military intelligence", "cia", "fbi", "spy", // Intelligence
            "spider", // Web
            // Space Exclusions
            "space shuttle", "spacecraft", "astronaut", "cosmonaut", "rocket", "orbit", 
            "mars", "moon", "solar system", "galaxy", "telescope", "space station", 
            "apollo", "soyuz", "gemini", "skylab", "mir ", "iss", "interstellar"
        ];

        // Backup facts
        const BACKUP_FACTS = [
            { text: "The first computer mouse was made of wood.", year: "1964" },
            { text: "The first 1GB hard drive was announced by IBM. It weighed over 500 pounds and cost $40,000.", year: "1980" },
            { text: "Email actually existed before the World Wide Web.", year: "1971" },
            { text: "The Firefox logo is actually a red panda, not a fox.", year: "2004" }
        ];

        let currentFactText = ""; // Store for AI usage

        // Strict "No Ess-Tsett" Policy
        function sanitizeText(text) {
            return text.replace(/ß/g, 'ss');
        }

        async function loadFact() {
            const factText = document.getElementById('fact-text');
            const yearDisplay = document.getElementById('year-display');
            const dateDisplay = document.getElementById('date-display');
            const sourceLink = document.getElementById('source-link');
            const aiPanel = document.getElementById('ai-panel');
            
            // UI Reset
            factText.innerHTML = '<span class="animate-pulse">Accessing daily log...</span>';
            yearDisplay.classList.add('opacity-0');
            sourceLink.classList.add('hidden');
            aiPanel.classList.add('hidden');
            document.getElementById('ai-status').innerText = "STANDBY";
            document.getElementById('ai-status').classList.remove('text-purple-400', 'animate-pulse');

            // Get Current Date
            const today = new Date();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const displayDate = sanitizeText(today.toLocaleDateString('en-US', options));
            
            dateDisplay.innerText = "Target Date: " + displayDate;

            try {
                // Fetch from Wikipedia On This Day API for TODAY
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/feed/onthisday/events/${month}/${day}`);
                if (!response.ok) throw new Error("API Failure");
                
                const data = await response.json();
                
                const techEvents = data.events.filter(event => {
                    const content = (event.text + " " + event.pages.map(p => p.title).join(" ")).toLowerCase();
                    
                    const hasKeyword = TECH_KEYWORDS.some(keyword => content.includes(keyword.toLowerCase()));
                    const hasExclusion = EXCLUDED_KEYWORDS.some(keyword => content.includes(keyword.toLowerCase()));
                    
                    return hasKeyword && !hasExclusion;
                });

                if (techEvents.length > 0) {
                    // Pick a random event from TODAY's filtered list
                    const event = techEvents[Math.floor(Math.random() * techEvents.length)];
                    currentFactText = sanitizeText(event.text);
                    
                    factText.innerText = currentFactText;
                    yearDisplay.innerText = event.year;
                    yearDisplay.classList.remove('opacity-0');

                    if (event.pages && event.pages[0]) {
                        sourceLink.href = event.pages[0].content_urls.desktop.page;
                        sourceLink.classList.remove('hidden');
                    }
                } else {
                    // If no events found for today, use backup
                    throw new Error("No events found for today");
                }

            } catch (error) {
                console.log("Using backup fact due to: " + error.message);
                const backup = BACKUP_FACTS[Math.floor(Math.random() * BACKUP_FACTS.length)];
                currentFactText = sanitizeText(backup.text);
                
                dateDisplay.innerText = displayDate + " [NO DATA - BACKUP LOADED]";
                factText.innerText = currentFactText;
                yearDisplay.innerText = backup.year;
                yearDisplay.classList.remove('opacity-0');
            }
        }

        async function decodeData() {
            if (!currentFactText) return;

            const aiPanel = document.getElementById('ai-panel');
            const aiContent = document.getElementById('ai-content');
            const aiSpinner = document.getElementById('ai-spinner');
            const aiStatus = document.getElementById('ai-status');

            // Show panel and loading state
            aiPanel.classList.remove('hidden');
            aiSpinner.classList.remove('hidden');
            aiContent.innerText = "Decrypting historical context...";
            aiStatus.innerText = "PROCESSING";
            aiStatus.classList.add('text-purple-400', 'animate-pulse');

            try {
                // Gemini API Call
                const prompt = `Context: A user is viewing a "Tech Fact of the Day" in a retro terminal app. 
                                Fact: "${currentFactText}". 
                                Task: Provide a fascinating, slightly technical, or humorous "backstory" or "deep dive" into this fact. 
                                Tone: Keep it Geeky/Hacker-like but readable. Max 3 sentences.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error("Gemini Connection Failed");

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;

                aiContent.innerText = aiText;
                aiStatus.innerText = "COMPLETE";
                aiStatus.classList.remove('animate-pulse');
                aiStatus.classList.add('text-green-500');

            } catch (error) {
                console.error(error);
                aiContent.innerText = "ERROR: UNABLE TO DECRYPT DATA STREAM. CONNECTION SEVERED.";
                aiStatus.innerText = "OFFLINE";
                aiStatus.classList.remove('text-purple-400', 'animate-pulse');
                aiStatus.classList.add('text-red-500');
            } finally {
                aiSpinner.classList.add('hidden');
            }
        }

        // Run on load
        window.onload = () => loadFact();
    </script>
</body>
</html>
